## Whole-Genome Resequencing and Population Genetics Analysis Handbook
---

## I. åŸå§‹æ•°æ®å¤„ç†é˜¶æ®µï¼ˆRaw Data Processingï¼‰

### 1. åŸå§‹æµ‹åºæ•°æ®

- **ç›®çš„**ï¼šè·å¾—ä¸‹æœºçš„åŸå§‹åŒç«¯æµ‹åºæ•°æ®ï¼ˆé€‚ç”¨äº Illuminaã€BGIã€Oxford Nanoporeã€PacBio ç­‰å¹³å°ï¼Œå¸¸è§æ ¼å¼ä¸º `*.fq.gz` æˆ– `*.fastq.gz`ï¼‰
- **æ ¼å¼**ï¼šåŒç«¯ readsï¼š`sample_R1.fq.gz`, `sample_R2.fq.gz`

---

### 2. æ•°æ®è´¨æ§ï¼ˆQuality Controlï¼‰

#### 2.1 FastQCï¼šå¿«é€Ÿè´¨é‡è¯„ä¼°

- **ç›®çš„**ï¼šè¯„ä¼°æµ‹åºè´¨é‡ã€æ±¡æŸ“å’Œæ¥å¤´æƒ…å†µ
- **åŸç†**ï¼šç»˜åˆ¶ per-base qualityã€GC contentã€æ¥å¤´æ±¡æŸ“å›¾è°±

```bash
fastqc sample_R1.fq.gz sample_R2.fq.gz -o fastqc_raw/
```

#### 2.2 fastpï¼šæ¥å¤´å»é™¤å’Œä½è´¨è¿‡æ»¤

- **ç›®çš„**ï¼šæ¸…é™¤æ¥å¤´æ±¡æŸ“ã€ä½è´¨é‡ reads
- **åŸç†**ï¼šè‡ªåŠ¨è¯†åˆ«æ¥å¤´å¹¶å‰ªåˆ‡ï¼Œä¿ç•™ Q20/Q30 é«˜è´¨é‡åŒºåŸŸ

```bash
fastp -i sample_R1.fq.gz -I sample_R2.fq.gz \
      -o clean_R1.fq.gz -O clean_R2.fq.gz \
      -h fastp_report.html -j fastp_report.json
```

---

##  II. æ•°æ®æ¯”å¯¹ä¸é¢„å¤„ç†

### 3. æ¯”å¯¹åˆ°å‚è€ƒåŸºå› ç»„ï¼ˆBWA-MEMï¼‰

- **ç›®çš„**ï¼šå°† reads ç²¾ç¡®å®šä½åˆ°å‚è€ƒåºåˆ—ä¸Š
- **åŸç†**ï¼šBWT ç®—æ³•å®ç°å¿«é€Ÿç§å­åŒ¹é…å’Œå±€éƒ¨æ¯”å¯¹ã€‚ç›®å‰æ¨èä½¿ç”¨ BWA-MEM2ï¼ˆBWA çš„å¹¶è¡Œä¼˜åŒ–ç‰ˆæœ¬ï¼‰ï¼Œå°¤å…¶é€‚ç”¨äºå¤šçº¿ç¨‹é«˜é€šé‡ç¯å¢ƒï¼Œå…¼å®¹æ€§ä¸ç»“æœä¸€è‡´æ€§è‰¯å¥½ã€‚

```bash
bwa index ref.fa
bwa mem2 -t 8 ref.fa clean_R1.fq.gz clean_R2.fq.gz > sample.sam
```

### 4. BAM å¤„ç†ä¸å»é‡

- **ç›®çš„**ï¼šè½¬æ¢ä¸ºå‹ç¼©æ ¼å¼ã€æ’åºã€æ ‡è®° PCR é‡å¤ï¼ˆæ¨èä½¿ç”¨å¤šçº¿ç¨‹å·¥å…·å¦‚ sambamba åŠ å¿«å¤„ç†é€Ÿåº¦ï¼‰

> **Picard vs Sambamba MarkDuplicates å¯¹æ¯”**ï¼š
>
> | ç‰¹æ€§       | Picard                 | Sambamba  |
> | -------- | ---------------------- | --------- |
> | ç¼–ç¨‹è¯­è¨€     | Java                   | Rust      |
> | å¤šçº¿ç¨‹æ”¯æŒ    | è¾ƒå¼±ï¼ˆä¸»è¦ç”¨äº I/Oï¼‰           | ä¼˜ç§€ï¼ˆ-t å‚æ•°ï¼‰ |
> | æ‰§è¡Œé€Ÿåº¦     | è¾ƒæ…¢                     | å¿«         |
> | å†…å­˜æ¶ˆè€—     | é«˜                      | ä½         |
> | è¾“å‡ºç»Ÿè®¡     | è¯¦ç»† duplication metrics | ç®€æ´        |
> | GATK å…¼å®¹æ€§ | é«˜ï¼ˆæ¨èï¼‰                  | é«˜ï¼ˆç»“æœå…¼å®¹ï¼‰   |
>
> **æ¨èï¼š**
>
> - å°è§„æ¨¡æ ·æœ¬æˆ– GATK å®Œå…¨ä¸€è‡´æ€§è¦æ±‚ â†’ ä½¿ç”¨ Picard
> - å¤šæ ·æœ¬æˆ–å¤§è§„æ¨¡ç¾¤ä½“æµ‹åº â†’ ä½¿ç”¨ Sambamba

```bash
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ samtools + picardï¼ˆé€‚åˆå°è§„æ¨¡æˆ–èµ„æºå……è¶³ç¯å¢ƒï¼‰
# å°† SAM è½¬æ¢ä¸º BAMï¼Œå¹¶ä½¿ç”¨ 8 çº¿ç¨‹æ’åºè¾“å‡º
samtools view -@ 8 -Sb sample.sam | samtools sort -@ 8 -o sample.sorted.bam
# æ ‡è®° PCR æ‰©å¢é‡å¤ï¼Œè¾“å‡ºå»é‡ BAM å’Œé‡å¤ç»Ÿè®¡ä¿¡æ¯
picard MarkDuplicates \
    I=sample.sorted.bam \      # è¾“å…¥æ’åºåçš„ BAM æ–‡ä»¶
    O=sample.dedup.bam \        # è¾“å‡ºå»é‡åçš„ BAM æ–‡ä»¶
    M=dup_metrics.txt           # è¾“å‡ºé‡å¤ç»Ÿè®¡ä¿¡æ¯
# å»ºç«‹ BAM ç´¢å¼•ï¼Œä¾¿äºåç»­è®¿é—®
samtools index sample.dedup.bam

# æ–¹æ³•äºŒï¼šä½¿ç”¨ sambambaï¼ˆå¤šçº¿ç¨‹æ•ˆç‡æ›´é«˜ï¼Œæ¨èç”¨äºå¤§è§„æ¨¡ WGSï¼‰
# SAM è½¬æ¢ä¸º BAM å¹¶æ’åºï¼ˆ-t ä¸ºçº¿ç¨‹æ•°ï¼‰
sambamba view -t 8 -S -f bam sample.sam | \
  sambamba sort -t 8 -o sample.sorted.bam /dev/stdin
# æ ‡è®°é‡å¤
sambamba markdup -t 8 sample.sorted.bam sample.dedup.bam
# å»ºç«‹ç´¢å¼•
sambamba index -t 4 sample.dedup.bam
```

---

## ğŸ§¬ III. å˜å¼‚æ£€æµ‹ï¼ˆVariant Callingï¼‰



### 5. GATK HaplotypeCaller æµç¨‹ï¼ˆSNP/Indelï¼‰

- **ç›®çš„**ï¼šæ£€æµ‹æ¯ä¸ªæ ·æœ¬çš„å˜å¼‚ä½ç‚¹
- **åŸç†**ï¼šé€šè¿‡å±€éƒ¨ de-novo ç»„è£…å¯»æ‰¾æ›¿ä»£ç­‰ä½åŸºå› 
- **æµç¨‹**ï¼š

| æ­¥éª¤ | å·¥å…·                | ç›®æ ‡                   |
| -- | ----------------- | -------------------- |
| 1  | HaplotypeCaller   | æ¯ä¸ªæ ·æœ¬æŒ‰æŸ“è‰²ä½“ç”Ÿæˆ GVCF      |
| 2  | CombineGVCFs      | åˆå¹¶æ‰€æœ‰æ ·æœ¬çš„æŸæ¡æŸ“è‰²ä½“çš„ GVCF   |
| 3  | GenotypeGVCFs     | è”åˆå˜å¼‚æ£€æµ‹ï¼Œç”Ÿæˆ cohort VCF |
| 4  | VariantFiltration | ç¡¬è¿‡æ»¤ä½è´¨é‡å˜å¼‚             |
| 5  | SelectVariants    | æ‹†åˆ† SNP / Indel       |
| 6  | æœ€ç»ˆè¾“å‡º              | ç”¨äº GWASã€åŠŸèƒ½æ³¨é‡Šç­‰        |

#### 5.1 å‡†å¤‡å‚è€ƒç´¢å¼•

```bash
picard CreateSequenceDictionary R=ref.fa O=ref.dict
samtools faidx ref.fa
```

#### 5.2 GVCF æ¨¡å¼æ£€æµ‹æ¯ä¸ªæ ·æœ¬

```bash
# åŸºæœ¬ç”¨æ³•
gatk HaplotypeCaller -R ref.fa -I sample.dedup.bam \
    -O sample.g.vcf.gz -ERC GVCF

### åˆ†æŸ“è‰²ä½“è¿è¡Œä»¥åŠ é€Ÿ:
#éœ€å‡†å¤‡å‚è€ƒåŸºå› ç»„çš„æŸ“è‰²ä½“ååˆ—è¡¨ chr.listï¼Œæ¯è¡Œä¸€ä¸ªæŸ“è‰²ä½“å###
# éå†æ¯æ¡æŸ“è‰²ä½“è¿›è¡Œ HaplotypeCaller åˆ†æŸ“è‰²ä½“è°ƒç”¨
while read chr; do
  gatk HaplotypeCaller \
    -R ref.fa \                             # å‚è€ƒåŸºå› ç»„
    -I sample.dedup.bam \                   # è¾“å…¥å»é‡ BAM æ–‡ä»¶
    -O gvcf_by_chr/$chr/sample.$chr.g.vcf.gz \  # æŒ‰æŸ“è‰²ä½“è¾“å‡º GVCF
    -ERC GVCF \                             # å¯ç”¨ GVCF æ¨¡å¼
    -L $chr                                 # åªè°ƒç”¨è¯¥æŸ“è‰²ä½“
done < chr.list

```

#### 5.3 è”åˆæ£€æµ‹

```bash
gatk CombineGVCFs -R ref.fa \
    -V sample1.g.vcf.gz -V sample2.g.vcf.gz \
    -O cohort.g.vcf.gz

gatk GenotypeGVCFs -R ref.fa -V cohort.g.vcf.gz \
    -O cohort.raw.vcf.gz

#åˆ†æŸ“è‰²ä½“
# å‡è®¾æ ·æœ¬åˆ—è¡¨ sample_list.txtï¼ŒæŸ“è‰²ä½“åˆ—è¡¨ chr.list
while read chr; do
  # åˆå¹¶æ‰€æœ‰æ ·æœ¬è¯¥æŸ“è‰²ä½“çš„ GVCF
  gatk CombineGVCFs \
    -R ref.fa \
    $(while read sample; do echo "-V gvcf_by_chr/$chr/${sample}.$chr.g.vcf.gz"; done < sample_list.txt) \
    -O cohort_gvcf_by_chr/$chr.cohort.g.vcf.gz

  # è”åˆåŸºå› åˆ†å‹
  gatk GenotypeGVCFs \
    -R ref.fa \
    -V cohort_gvcf_by_chr/$chr.cohort.g.vcf.gz \
    -O cohort_vcf_by_chr/$chr.cohort.vcf.gz
done < chr.list


## é€šè¿‡GenomicsDBImportæ¥åˆå¹¶å˜å¼‚çš„ç»“æœ
#æµç¨‹
æ ·æœ¬GVCFï¼ˆåˆ†æŸ“è‰²ä½“è·å¾—ï¼‰
  -->GenomicsDBImportï¼ˆæ„å»ºæŸ“è‰²ä½“çº§æ•°æ®åº“ï¼‰
    --> GenotypeGVCFsï¼ˆè”åˆåˆ†å‹è¾“å‡º VCFï¼‰

# step1 built a sample map
#ä¸€ä¸ªåˆ¶è¡¨ç¬¦åˆ†éš”çš„æ ·æœ¬æ–‡ä»¶
sample001 /path/to/sample001.chr01.g.vcf.gz
sample002 /path/to/sample002.chr01.g.vcf.gz
...
ä¿å­˜ä¸ºchr01.sample_map.txt

#step2 built GenomicDb
gatk GenomicsDBImport \  
  -R ref.fa \
  --genomicsdb-workspace-path genomicsdb/chr01 \ #æ›¿æ¢ä¸ºå®é™…è·¯å¾„
  --sample-name-map chr01.sample_map.txt \
  -L chr01 \
  --batch-size 150 \ æ§åˆ¶å†…å­˜ä½¿ç”¨ï¼Œ100--200ä¸ºå®œ
  --reader-threads 4

#step3 jointgenotype
gatk GenotypeGVCFs \
  -R ref.fa \
  -V gendb://genomicsdb/chr01 \
  -O cohort/chr01.vcf.gz

åœ¨æ ·æœ¬æ•°é‡å¤§æ—¶ï¼Œä½¿ç”¨GenomicDbçš„æ–¹å¼å¯ä»¥æå¤§çš„æé«˜è¿è¡Œé€Ÿåº¦
```
#### 5.4 å˜å¼‚è¿‡æ»¤ï¼ˆVariantFiltrationï¼‰

```bash
gatk VariantFiltration -R ref.fa -V cohort.raw.vcf.gz \
    --filter-expression "QD < 2.0 || FS > 60.0" \
    --filter-name "LowQual" -O cohort.filtered.vcf.gz

###æˆ–è€…æ›´è¯¦ç»†
gatk VariantFiltration -O chr5.Filt.vcf -V chr5.vcf 
--cluster-window-size 10 
--filter-expression "MQ0 >= 4 && ((MQ0 / (1.0 * DP)) > 0.1)" --filter-name "HARD_TO_VALIDATE" 
--filter-expression "DP < 5 " --filter-name "LowCoverage" 
--filter-expression "QUAL < 30.0 " --filter-name "VeryLowQual" 
--filter-expression "QUAL > 30.0 && QUAL < 50.0 " --filter-name "LowQual" 
--filter-expression "QD < 1.5 " --filter-name "LowQD"
```
#### æ˜¯å¦éœ€è¦åŠ å‚æ•°-Ræ¥æ·»åŠ å‚è€ƒåŸºå› ç»„ï¼Ÿ
GATK 4 ä¸­çš„ VariantFiltration è¯´æ˜ï¼š
  -R is required only if certain annotations or filtering expressions require access to reference sequence information

| ä½¿ç”¨åœºæ™¯                                                                                                         | æ˜¯å¦å¿…é¡»åŠ  `-R` |
| ------------------------------------------------------------------------------------------------------------ | ---------- |
| ä½¿ç”¨ `FS`ã€`QD`ã€`MQ`ã€`QUAL` ç­‰å·²æœ‰ INFO å­—æ®µè¿›è¡Œè¿‡æ»¤                                                                     |  ä¸éœ€è¦å‚è€ƒåŸºå› ç»„ |
| ä½¿ç”¨ `VariantType`ï¼ˆå¦‚åˆ¤æ–­æ˜¯å¦ indel/SNPï¼‰ã€`Context`, `Length`, `Windowing`, `SnpCluster`, `Mask` ç­‰æ¶‰åŠ ref base æˆ–ä½ç½®çš„è¿‡æ»¤ | éœ€è¦ `-R`  |
ä¿é™©èµ·è§å¯ä»¥éƒ½åŠ ä¸Š
#### ç¡¬è¿‡æ»¤å‚æ•°å‚è€ƒ
```
--filter-expression "QD < 2.0"               --filter-name "LowQD"
--filter-expression "FS > 60.0"              --filter-name "StrandBias"
--filter-expression "MQ < 40.0"              --filter-name "LowMappingQual"
--filter-expression "MQRankSum < -12.5"      --filter-name "BadMQBalance"
--filter-expression "ReadPosRankSum < -8.0"  --filter-name "EdgeBias"
```


#### 5.5 æå–å˜å¼‚ç±»å‹
è¿™ä¸€æ­¥å¯ä»¥åœ¨è”åˆåŸºå› åˆ†å‹ååšï¼Œä¹Ÿå¯ä»¥åœ¨è¿‡æ»¤ä½è´¨é‡å˜å¼‚åæ“ä½œ
```bash
  # æå–å˜å¼‚ç±»å‹
  gatk SelectVariants -R base/example.fasta -V test.vcf -O test.snp.vcf --select-type-to-include SNP
  # -R å‚è€ƒåŸºå› ç»„ -O è¾“å‡ºvcfæ–‡ä»¶ -V è¾“å…¥vcfæ–‡ä»¶ --select-type-to-include é€‰å–æå–çš„å˜å¼‚ç±»å‹(#SNP,MNP,INDEL,SYMBOLIC,MIXED)

# æå–é«˜è´¨é‡SNP
gatk SelectVariants \
  -R ref.fa \
  -V filtered_vcf/chr01.filtered.vcf.gz \
  --select-type-to-include SNP \
  --exclude-filtered \
  -O snp_vcf/chr01.snp.vcf.gz

# æå–é«˜è´¨é‡Indel
gatk SelectVariants \
  -R ref.fa \
  -V filtered_vcf/chr01.filtered.vcf.gz \
  --select-type-to-include INDEL \
  --exclude-filtered \
  -O indel_vcf/chr01.indel.vcf.gz
```
#### 5.6 åˆå¹¶æŸ“è‰²ä½“
```
gatk GatherVcfs \
  -I snp_vcf/chr01.snp.vcf.gz \
  -I snp_vcf/chr02.snp.vcf.gz \
  ... \
  -O final/cohort.snp.vcf.gz
```
#### 5.7 ä½¿ç”¨snpEffè¿›è¡Œå˜å¼‚æ³¨é‡Š
```bash
# å‡†å¤‡è¾“å…¥æ•°æ®
ref.fa \ ref.gff3 \ vcf.gz
#å»ºåº“
#Aé…ç½®ç‰©ç§å
cd snpEff/data/
mkdir kiwifruit
cp ~/ref.fa kiwifruit/sequences.fa
cp ~/genes.gff3 kiwifruit/genes.gff
#Bç¼–è¾‘é…ç½®æ–‡ä»¶
#æ‰“å¼€ snpEff.configï¼Œåœ¨è¡Œå°¾æ·»åŠ 
kiwifruit.genome : Kiwifruit
#Cå»ºåº“
cd snpEff
java -Xmx4g -jar snpEff.jar build -gff3 -v kiwifruit

##æ‰§è¡Œæ³¨é‡Šç”Ÿæˆæ³¨é‡ŠæŠ¥å‘Š
java -Xmx4g -jar snpEff.jar -v kiwifruit cohort.snp.vcf.gz > cohort.snp.ann.vcf
java -Xmx4g -jar snpEff.jar -v kiwifruit -stats cohort.snp.stats.html cohort.snp.vcf.gz > annotated.vcf

```
---
##  IV. ç¾¤ä½“å˜å¼‚å¤„ç†

### 6. VCF åˆå¹¶ä¸è¿‡æ»¤

- **ç›®çš„**ï¼šç»Ÿä¸€å˜å¼‚ä½ç‚¹æ ¼å¼ï¼Œç§»é™¤ä½è´¨é‡ä¸ç¼ºå¤±

```bash
bcftools merge *.vcf.gz -Oz -o merged.vcf.gz
vcftools --gzvcf merged.vcf.gz \
  --minDP 5 --max-missing 0.8 --maf 0.05 \
  --recode --out final
```

---

##  V. ç¾¤ä½“é—ä¼ åˆ†æ

### 7. PCA ä¸»æˆåˆ†åˆ†æ

- **ç›®çš„**ï¼šæ­ç¤ºç¾¤ä½“é—´çš„é—ä¼ åˆ†åŒ–ä¸ç»“æ„
- **åŸç†**ï¼šåŸºäº SNP æ„å»ºåæ–¹å·®çŸ©é˜µï¼Œè¿›è¡Œç‰¹å¾åˆ†è§£

```bash
plink --vcf final.recode.vcf --make-bed --out data
plink --bfile data --pca 10 --out pca
```

### 8. Admixture ç¾¤ä½“ç»“æ„åˆ†æ

- **ç›®çš„**ï¼šä¼°ç®—æ¯ä¸ªä¸ªä½“çš„ç¥–å…ˆæˆåˆ†ï¼ˆK ç»„ï¼‰

```bash
admixture data.bed 3 # 3 ä»£è¡¨ K å€¼
```

### 9. ç¾¤ä½“å¤šæ ·æ€§ä¸åˆ†åŒ–åˆ†æ

#### 9.1 æ ¸è‹·é…¸å¤šæ ·æ€§ï¼ˆÏ€ï¼‰

```bash
vcftools --vcf final.recode.vcf --window-pi 10000 --out pi
```

#### 9.2 Tajima's D

```bash
vcftools --vcf final.recode.vcf --TajimaD 10000 --out tajima
```

#### 9.3 Fst åˆ†åŒ–æŒ‡æ•°

```bash
vcftools --vcf final.recode.vcf \
  --weir-fst-pop group1.txt --weir-fst-pop group2.txt \
  --out fst
```

---

##  VI. å˜å¼‚æ³¨é‡Šä¸å€™é€‰ä½ç‚¹ç­›é€‰

### 10. SnpEff æ³¨é‡Š

- **ç›®çš„**ï¼šæ³¨é‡Šå˜å¼‚åŠŸèƒ½ä½ç½®ï¼ˆå¦‚å¯åŠ¨å­ã€å¤–æ˜¾å­ã€éåŒä¹‰ï¼‰

```bash
snpEff build -gff3 -v Actinidia_ref
snpEff Actinidia_ref final.recode.vcf > annotated.vcf
```

### 11. å·®å¼‚å˜å¼‚ç­›é€‰

- **ç›®çš„**ï¼šç­›é€‰ç‰¹å®šç¾¤ä½“æˆ–æ€§çŠ¶çš„ç‰¹å¼‚å˜å¼‚ä½ç‚¹

```bash
vcftools --vcf annotated.vcf --keep group1.txt --recode --out group1
vcftools --vcf annotated.vcf --keep group2.txt --recode --out group2
vcftools --diff group1.recode.vcf group2.recode.vcf --out diff
```

### 12. GWAS åˆ†æï¼ˆä»¥ GEMMA ä¸ºä¾‹ï¼‰

```bash
# å‡è®¾å·²æœ‰ plink æ–‡ä»¶å’Œæ€§çŠ¶æ–‡ä»¶
gemma -bfile data -p phenotype.txt -gk 1 -o kinship

gemma -bfile data -p phenotype.txt -k output/kinship.cXX.txt \
      -lmm 4 -o gwas_result
```


---

##  ä¸€ã€æ˜¯å¦å¯ä»¥åæœŸå‰”é™¤æ— è¡¨å‹æ ·æœ¬ï¼Ÿ

**ç­”æ¡ˆï¼šå¯ä»¥ï¼Œè€Œä¸”æ¨èåœ¨ GWAS å‰å‰”é™¤ã€‚**

> **VCF ä¸­åŒ…å«æ— è¡¨å‹æ ·æœ¬å¹¶ä¸ä¼šå½±å“ä½ å‰æœŸçš„å˜å¼‚æ£€æµ‹æµç¨‹ï¼›åªè¦åœ¨ä¸‹æ¸¸ GWAS å‰è¿‡æ»¤æ‰è¿™äº›æ ·æœ¬å³å¯ã€‚**

---

##  åŸå› åˆ†æï¼š

### 1. GVCF â†’ VCF çš„è”åˆå˜å¼‚æ£€æµ‹é˜¶æ®µï¼š

* æ‰€æœ‰æ ·æœ¬çš„ GVCF ç”¨äºæ„å»º **å…¨ä½“æ ·æœ¬çš„ç¾¤ä½“ç­‰ä½åŸºå› é¢‘ç‡ä¿¡æ¯**ï¼›
* å³ä½¿æŸä¸ªæ ·æœ¬æ— è¡¨å‹ï¼Œä¹Ÿå¯¹ **ç­‰ä½åŸºå› çš„é¢‘ç‡ä¼°è®¡ã€æ‚åˆæ€§ã€ç½®ä¿¡åº¦å»ºæ¨¡**æœ‰è´¡çŒ®ï¼›
* **ä¿ç•™è¿™äº›æ ·æœ¬åœ¨ç¾¤ä½“ VCF ä¸­æ˜¯æ­£ç¡®çš„ç­–ç•¥ã€‚**

---

### 2. GWAS é˜¶æ®µï¼ˆå¦‚ plink, GEMMA, GAPIT ç­‰ï¼‰ï¼š

* GWAS å·¥å…·ä¸€èˆ¬è¦æ±‚ **VCF ä¸è¡¨å‹æ–‡ä»¶ä¸­æ ·æœ¬å®Œå…¨åŒ¹é…**ï¼›
* å¤šä½™æ ·æœ¬ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¸ä¼šå‚ä¸æ¨¡å‹è®¡ç®—ï¼›
* æ›´å¥½çš„åšæ³•æ˜¯ï¼š**æå‰è¿‡æ»¤æ‰æ— è¡¨å‹çš„æ ·æœ¬**ï¼Œä»¥å…æ··æ·†ã€‚

---

##  äºŒã€VCF ä¸­å¦‚ä½•å‰”é™¤æ— è¡¨å‹æ ·æœ¬ï¼Ÿ

###  æ–¹æ³• 1ï¼šä½¿ç”¨ `bcftools view -s`

å‡è®¾ä½ æœ‰ä¸€ä¸ª **åŒ…å«æœ‰è¡¨å‹çš„æ ·æœ¬åˆ—è¡¨**ï¼Œä¾‹å¦‚ `samples_with_phenotype.txt`ï¼š

```
sample001
sample005
sample007
...
```

é‚£ä¹ˆè¿è¡Œï¼š

```bash
bcftools view \
  -S samples_with_phenotype.txt \
  -Oz -o gwas_ready.vcf.gz \
  cohort.all.vcf.gz
```

è¿™ä¼šç”Ÿæˆä¸€ä¸ª **åªåŒ…å«æœ‰è¡¨å‹æ ·æœ¬** çš„ VCFï¼Œå¯ç”¨äº PLINKã€GEMMAã€GAPIT ç­‰å·¥å…·ã€‚

---

###  æ–¹æ³• 2ï¼šåœ¨è½¬æ¢ä¸º plink/binary æ ¼å¼æ—¶æŒ‡å®šæ ·æœ¬

```bash
plink --vcf cohort.all.vcf.gz \
      --keep samples_with_phenotype.txt \
      --make-bed --out gwas_input
```

> `--keep` åªä¼šä¿ç•™ä½ æŒ‡å®šçš„æ ·æœ¬ï¼Œå…¶ä½™çš„åœ¨ç”Ÿæˆ `.bed/.bim/.fam` è¿‡ç¨‹ä¸­å°±å‰”é™¤äº†ã€‚

---

##  ä¸‰ã€æœ€ä½³å®è·µæµç¨‹å»ºè®®

| é˜¶æ®µ            | æ“ä½œ                    | æ ·æœ¬èŒƒå›´          |
| ------------- | --------------------- | ------------- |
| GVCF æ„å»º       | HaplotypeCaller       | æ‰€æœ‰æ ·æœ¬          |
| GVCF åˆå¹¶       | CombineGVCFs          | æ‰€æœ‰æ ·æœ¬          |
| GenotypeGVCFs | è”åˆæ£€æµ‹                  | æ‰€æœ‰æ ·æœ¬          |
| GWAS è¾“å…¥å‡†å¤‡     | bcftools/plink ç­›é€‰æ ·æœ¬   | ä»…æœ‰è¡¨å‹çš„æ ·æœ¬       |
| GWAS åˆ†æ       | GAPIT / GEMMA / EMMAX | è¡¨å‹ Ã— VCF ä¸€è‡´æ ·æœ¬ |

---


---



